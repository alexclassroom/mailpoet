parameters:
  level: 9
  tmpDir: ../../temp/phpstan
  bootstrapFiles:
    - ../../vendor/autoload.php
    - vendor/php-stubs/wordpress-stubs/wordpress-stubs.php
    - ../../vendor/codeception/codeception/autoload.php
    - ../../vendor/codeception/verify/src/Codeception/Verify/Verify.php
  scanDirectories:
      - ../../../packages/php/email-editor/tests/_support
      - ../../../packages/php/email-editor/tests/integration
      - ../../../packages/php/email-editor/tests/unit
  inferPrivatePropertyTypeFromConstructor: true
  checkGenericClassInNonGenericObjectType: false
  parallel:
    processTimeout: 300.0
    maximumNumberOfProcesses: 3 # Static analysis is running on Circle CI medium+ that has 3 CPUs
  ignoreErrors:
    - '#_before\(\) has no return type specified#' # skip integration test before errors
    - '#Container::get\(\) is not referenced in a parameter.#'
    -
      message: '#Cannot call method initialize\(\) on mixed#'
      path: ../../../packages/php/email-editor/tests/integration/*
    -
      message: '#has no return type specified.#'
      path: ../../../packages/php/email-editor/tests/integration/*
    -
      message: '#assertStringContainsString\(\) expects string#'
      path: ../../../packages/php/email-editor/tests/integration/*
    -
      message: '#assertStringNotContainsString\(\) expects string#'
      path: ../../../packages/php/email-editor/tests/integration/*
    -
     message: '#settings_controller \(MailPoet\\EmailEditor\\Engine\\Settings_Controller\) does not accept mixed#'
     path: ../../../packages/php/email-editor/tests/integration/*
    -
     message: '#Renderer\) does not accept mixed.#'
     path: ../../../packages/php/email-editor/tests/integration/*
    -
     message: '#Access to an undefined property MailPoet\\EmailEditor\\.*Test::\$tester.#'
     path: ../../../packages/php/email-editor/tests/integration/*
  reportUnmatchedIgnoredErrors: true
  dynamicConstantNames:
    - MAILPOET_PREMIUM_INITIALIZED
    - MAILPOET_PREMIUM_VERSION

  # exclude level 6 errors
  checkMissingIterableValueType: false
  treatPhpDocTypesAsCertain: false # We have some incorrect phpdoc types, but I want to address them later
  excludePaths:
    analyseAndScan:
      - vendor/php-stubs/wordpress-stubs/wordpress-stubs.php # does not yet offer support for PHP 8.1
      - ../../../packages/php/email-editor/tests/unit/_stubs.php
includes:
  - extensions/CodeceptionExtension/extension.neon
  - vendor/phpstan/phpstan-phpunit/extension.neon
  - vendor/szepeviktor/phpstan-wordpress/extension.neon
